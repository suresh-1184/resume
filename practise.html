<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURORA_DEBUGGER | Campaign Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --aurora-green: #00ffcc;
            --aurora-purple: #a020f0;
            --aurora-blue: #00d4ff;
            --terminal-bg: rgba(2, 12, 20, 0.9);
            --glow: 0 0 20px rgba(0, 255, 204, 0.4);
            --warn-red: #ff4b2b;
            --locked-gray: #444;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Rajdhani', sans-serif;
            background: #02050a;
        }

        /* --- BACKGROUND ANIMATION --- */
        .aurora-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: linear-gradient(to bottom, #02050a, #051923); }
        .aurora-waves { position: absolute; width: 100%; height: 100%; top: 0; left: 0; background: radial-gradient(circle at 20% 30%, var(--aurora-green) 0%, transparent 40%), radial-gradient(circle at 80% 40%, var(--aurora-blue) 0%, transparent 40%), radial-gradient(circle at 50% 20%, var(--aurora-purple) 0%, transparent 50%); filter: blur(80px); opacity: 0.4; animation: aurora-drift 12s ease-in-out infinite alternate; }
        @keyframes aurora-drift { 0% { transform: scale(1) translate(0, 0); opacity: 0.3; } 100% { transform: scale(1.1) translate(-2%, -3%); opacity: 0.3; } }
        canvas#starfield { position: fixed; top: 0; left: 0; z-index: -1; }

        /* --- SCREENS --- */
        .screen { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; }
        
        /* Welcome Screen */
        #welcome-screen h1 { font-size: 4rem; letter-spacing: 10px; margin-bottom: 10px; text-shadow: var(--glow); }
        #welcome-screen p { font-size: 1.5rem; color: var(--aurora-blue); max-width: 600px; margin-bottom: 40px; }

        /* --- TERMINAL & LAYOUT --- */
        .terminal {
            background: var(--terminal-bg); width: 95vw; max-width: 1100px;
            height: 85vh; border-radius: 20px; border: 1px solid rgba(0, 255, 204, 0.3);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8), var(--glow);
            backdrop-filter: blur(15px); display: flex; flex-direction: column;
            overflow: hidden; animation: terminal-float 6s ease-in-out infinite;
        }
        @keyframes terminal-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .status-bar {
            background: rgba(0, 255, 204, 0.1); padding: 10px 25px;
            display: flex; justify-content: space-between;
            font-family: 'Share Tech Mono', monospace; color: var(--aurora-green);
            font-size: 0.8rem; border-bottom: 1px solid rgba(0, 255, 204, 0.2);
        }

        .content-area { display: flex; flex: 1; padding: 25px; gap: 20px; overflow-y: auto; }
        .pane { flex: 1; display: flex; flex-direction: column; min-width: 0; text-align: left; }

        /* --- LEVEL SELECTION --- */
        .lvl-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; padding: 40px; width: 100%; box-sizing: border-box; }
        .lvl-card {
            background: rgba(255,255,255,0.05); border: 2px solid var(--aurora-blue);
            padding: 20px; border-radius: 12px; cursor: pointer; transition: 0.3s;
            text-align: center; position: relative; color: white;
        }
        .lvl-card:hover:not(.locked) { background: rgba(0, 255, 204, 0.2); transform: scale(1.05); box-shadow: 0 0 15px var(--aurora-blue); }
        .lvl-card.locked { border-color: var(--locked-gray); opacity: 0.4; cursor: not-allowed; }

        /* --- NEON UI --- */
        .label { font-weight: 700; letter-spacing: 2px; color: var(--aurora-green); margin-bottom: 8px; font-size: 1rem; }
        .code-screen { 
            background: rgba(0, 20, 15, 0.95); border: 2px solid var(--aurora-green); 
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.3); border-radius: 10px; 
            padding: 20px; color: #fff; font-family: 'Share Tech Mono', monospace; 
            font-size: 1rem; flex-grow: 1; white-space: pre-wrap; overflow-y: auto; position: relative; line-height: 1.4;
        }
        .lang-tag { position: absolute; top: 10px; right: 10px; background: var(--aurora-purple); color: white; padding: 4px 10px; font-size: 0.75rem; border-radius: 4px; font-weight: bold; }
        textarea { 
            background: rgba(0, 20, 15, 0.95); border: 2px solid var(--aurora-green); 
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.3); border-radius: 10px; 
            padding: 15px; color: #fff; font-family: 'Share Tech Mono', monospace; 
            height: 100px; resize: none; outline: none; margin-bottom: 10px; font-size: 1rem;
        }

        .btn-patch { background: var(--aurora-green); color: #020c14; border: none; padding: 14px; font-weight: 900; border-radius: 8px; cursor: pointer; text-transform: uppercase; transition: 0.3s; width: 100%; font-family: 'Rajdhani'; font-size: 1.1rem; }
        .btn-patch:hover { box-shadow: 0 0 20px var(--aurora-green); filter: brightness(1.2); }
        .btn-skip { background: transparent; border: 2px solid var(--warn-red); color: var(--warn-red); padding: 10px; font-weight: 900; border-radius: 8px; cursor: pointer; text-transform: uppercase; transition: 0.3s; margin-top: 10px; width: 100%; font-family: 'Rajdhani'; }
        .btn-skip:hover { background: var(--warn-red); color: white; box-shadow: 0 0 20px var(--warn-red); }

        #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(15px); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-card { background: #0a141d; border: 2px solid var(--aurora-blue); padding: 40px; border-radius: 15px; text-align: center; max-width: 500px; color: white; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="aurora-bg"><div class="aurora-waves"></div></div>
<canvas id="starfield"></canvas>

<div id="welcome-screen" class="screen animate__animated animate__fadeIn">
    <h1 class="animate__animated animate__pulse animate__infinite">CODE ARENA</h1>
    <p>The global data core has been corrupted. Only a master debugger can rewrite the logic and save the network. Are you ready to initialize?</p>
    <button class="btn-patch" style="width: 350px; font-size: 1.5rem;" onclick="enterChallenge()">ENTER INTO THE CHALLENGE</button>
</div>

<div id="game-container" class="screen hidden">
    <div class="terminal">
        <div class="status-bar">
            <span>CORE_OS_v4.0</span>
            <span id="overall-score-display">TOTAL SCORE: 0/2500</span>
            <span id="level-tracker">UPLINK_PENDING</span>
        </div>

        <div id="start-screen" class="animate__animated animate__fadeIn">
            <h1 style="text-align: center; margin-top: 20px; letter-spacing: 3px; color: var(--aurora-green);">SELECT SECTOR</h1>
            <div class="lvl-grid" id="level-grid"></div>
        </div>

        <div id="game-screen" class="content-area hidden animate__animated animate__fadeIn">
            <div class="pane">
                <div class="label" id="current-difficulty-label">DIFFICULTY: EASY</div>
                <div class="code-screen">
                    <div id="lang-tag" class="lang-tag">PYTHON</div>
                    <div id="code-box"></div>
                </div>
                <p id="objective-text" style="color: var(--aurora-blue); font-size: 0.9rem; margin-top: 10px; font-weight: bold;"></p>
            </div>
            
            <div class="pane">
                <div class="label">REPAIR_BUFFER</div>
                <textarea id="user-input" placeholder="Type the exact fix..."></textarea>
                <button class="btn-patch" onclick="checkFix()">APPLY PATCH</button>
                <button class="btn-skip" onclick="skipQuestion()">SKIP DATA BLOCK</button>
                <div id="lvl-score-tracker" style="margin-top:20px; color: var(--aurora-green); font-family: 'Share Tech Mono'; font-size: 1.2rem;">LEVEL_SCORE: 0</div>
            </div>
        </div>
    </div>
</div>

<div id="modal-overlay">
    <div class="modal-card animate__animated animate__zoomIn" id="modal-content"></div>
</div>

<div id="toast-msg" class="animate__animated hidden" style="position: fixed; top: 15%; left: 50%; transform: translateX(-50%); font-size: 2rem; font-weight: 900; z-index: 1000; pointer-events: none;"></div>

<script>
    // --- STARFIELD ---
    const canvas = document.getElementById('starfield');
    const ctx = canvas.getContext('2d');
    let stars = [];
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    function initStars() { stars = []; for(let i=0; i<200; i++) stars.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: Math.random() * 2, opacity: Math.random(), speed: Math.random() * 0.02 }); }
    function drawStars() { ctx.clearRect(0, 0, canvas.width, canvas.height); stars.forEach(s => { s.opacity += s.speed; if(s.opacity > 1 || s.opacity < 0) s.speed = -s.speed; ctx.fillStyle = `rgba(255, 255, 255, ${s.opacity})`; ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI*2); ctx.fill(); }); requestAnimationFrame(drawStars); }
    window.addEventListener('resize', resize); resize(); initStars(); drawStars();

    function enterChallenge() {
        document.getElementById('welcome-screen').classList.add('hidden');
        document.getElementById('game-container').classList.remove('hidden');
        initMenu();
    }

    // --- GAME DATA ---
    const levels = [
        { name: "BASIC_INIT", diff: "Easy", count: 15, pts: 50, unlocked: true, score: 0, completed: false }, // 15 * 50 = 750
        { name: "NEURAL_SYNC", diff: "Medium", count: 10, pts: 75, unlocked: false, score: 0, completed: false }, // 10 * 75 = 750
        { name: "CORE_REPAIR", diff: "Hard", count: 5, pts: 200, unlocked: false, score: 0, completed: false },   // 5 * 200 = 1000
    ];
    // Total: 750 + 750 + 1000 = 2500

    const campaignPool = [
    // --- EASY (Blocks 1-15) ---
    { lang: "Python", bug: "def system_check(node):\n    print('Scanning ' + node)\n    status = 'Active'\n    if status == 'Active'\n        return True\n    return False", fix: "Active':", obj: "Missing colon in IF statement.", diff: "Easy" },
    { lang: "C", bug: "#include <stdio.h>\n\nint main() {\n    int ver = 2;\n    printf(Aurora v%d, ver);\n    return 0;\n}", fix: '"Aurora v%d, ver"', obj: "Missing double quotes in printf.", diff: "Easy" },
    { lang: "JS", bug: "const core_temp = 45;\nif (core_temp > 40) {\n    core_temp = 30;\n    console.log('Cooling...');\n}", fix: "let core_temp", obj: "Cannot reassign a constant.", diff: "Easy" },
    { lang: "Java", bug:" public class Main{\npublic static void main(String[] args){\nString s=null;\n System.out.println(s.length());\n \n }", fix: "static void", obj: "Main method must be static.", diff: "Easy" },
    { lang: "HTML", bug: "<div>\n    <h1>System Menu</h1>\n    <img src='icon.png'>\n    <p>Click to start</p>\n</div>", fix: "alt=", obj: "Missing alt attribute for image.", diff: "Easy" },
    { lang: "Python", bug: "s = hello \n print(s.upper) \n ", fix: "'hello'", obj: "String needs quotes.", diff: "Easy" },
    { lang: "JS", bug: "Let a = [1,2,3];\n a.concat([4,5]); \nconsole.log(a); \n", fix: "let a", obj: "Lowercase 'let' required.", diff: "Easy" },
    { lang: "C", bug: "#include <stdio.h>\n\nint main() {\n    int a = 5, b = 10;\n    printf(\"Sum = %d\", a + b)\n    return 0;\n}\n", fix: "std::", obj: "Missing standard namespace.", diff: "Easy" },
    { lang: "Java", bug: "public class Main{\n \" +\"public static void main(String[] args){\n \" +\"  System.out.println(\"Sum = \"+(10+20));\n" +"    }\n" +"}\n", fix: "items:", obj: "Missing colon in for loop.", diff: "Easy" },
    { lang: "HTML", bug: "<html>\n" +"<body>\n" +" <p>Hello World\n" +"    <p>Welcome to HTML</p>\n" +"</body>\n" +"</html>\n", fix: "items:", obj: "Missing colon in for loop.", diff: "Easy" },
    { lang: "Python", bug: "def login():\n    try:\n        auth = True\n        print(auth)\n    except\n        print('Error')\n    finally:\n        close()", fix: "except:", obj: "Except block requires a colon.", diff: "Easy" },
    { lang: "JS", bug: "let x = 5; \n if (x = 10)\n { \n console.log(\"Yes\"); \n }", fix: "ById", obj: "Fix camelCase for DOM method.", diff: "Easy" },
    { lang: "C", bug: "int main() {\n    int limit = 100\n    printf(\"Limit: %d\", limit);\n    return 0;\n}", fix: "100;", obj: "Missing semicolon.", diff: "Easy" },
    { lang: "Java", bug: "public class Main{\npublic static void main(String[] args){\nfor(int i=1;i>=5;i++){\nSystem.out.print(i+\" \");\n}\n", fix: "i < logs", obj: "Fix array index out of bounds.", diff: "Easy" },
    { lang: "HTML", bug: "<html>\n" +"<body>\n" +"    <ul>\n" +" <li>Apple\n" +" <li>Banana</li>\n" +"<li>Orange</li>\n" +"    </ul>\n" +"</body>\n" +"</html>\n", fix: "WHERE", obj: "Add a filter to prevent mass corruption.", diff: "Easy" },

    // --- MEDIUM (Blocks 1-10) ---
    { lang: "Python", bug: "numbers = [1, 2, 3, 4, 5, 6] \n sum = 0\n for i in numbers:\n if i % 2 == 1:\n  sum += i\n print(\"Sum =\", sum)\n", fix: "Active':", obj: "Missing colon in IF statement.", diff: "Medium" },
    { lang: "C", bug: "#include <stdio.h> \n int fact(int n) \n { \n if(n == 0) \n return 0;  \n else  \n  return n * fact(n - 1); \n \n } \n int main() { \n    printf(\"%d\", fact(5));\n   return 0; \n ", fix: '"Aurora v%d, ver"', obj: "Missing double quotes in printf.", diff: "Medium" },
    { lang: "JS", bug: "let str = \"education\";\nlet count = 0;\n\nfor (let ch of str) {\n    if (ch == 'a' || 'e' || 'i' || 'o' || 'u') {\n        count++;\n    }\n}\n\nconsole.log(count);\n", fix: "let core_temp", obj: "Cannot reassign a constant.", diff: "Medium" },
    { lang: "Java", bug:" public class Main{ \n public static void main(String[] args) \n { \n  System.out.println(5/2); \n} \n}", fix: "static void", obj: "Main method must be static.", diff: "Medium" },
    { lang: "HTML", bug: "<html>\n \" +\"<body\n" +"    <table border=\"1\">\n" +"        <tr>\n" + "            <td>Name</td>\n" + "            <td>Age</td>\n" + "        </tr>\n" + "        <tr>\n" + "            <td>Priya</td>\n" + "            <td>20\n" + "        </tr>\n" + "    </table>\n" + "</body>\n" + "</html>\n", fix: "alt=", obj: "Missing alt attribute for image.", diff: "Medium" },
    { lang: "Python", bug: "numbers = [1, 2, 3, 4, 5, 6]\nsum = 0\n\nfor i in numbers:\n    if i % 2 == 1:\n sum += i \n print(sum)\n ", fix: "sum:", obj: "Indentation issue.", diff: "Medium" },
    { lang: "JS", bug: "console.log(parseInt(\"10.5\") + 1);", fix: "parseFloat", obj: "Parsing float as int.", diff: "Medium" },
    { lang: "C", bug: "#include <stdio.h>\n\nint main() {\n    int i;\n    for(i = 1; i <= 5; i--);\n        printf(\"%d \", i);\n\n    return 0;\n}\n", fix: "std::", obj: "Missing standard namespace.", diff: "Medium" },
    { lang: "Java", bug: "public class Main{ \n public static void main(String[] args) \n Scanner sc=new Scanner(System.in); \n \n int x=sc.nextInt(); \n System.out.println(x);  \n  } \n }\n", fix: "items:", obj: "Missing colon in for loop.", diff: "Medium" },
    { lang: "HTML", bug: "<html>\n<body>\n    <h1>Welcome\n    <p>This is HTML debugging</p>\n</body>\n</html>\n", fix: "items:", obj: "Missing colon in for loop.", diff: "Medium" },

    // --- HARD / MASTER (Blocks 1-5) ---
    { lang: "Python", bug: "def calculate_average(nums):\n    total = 0\n    for i in range(len(nums)):\n        total += nums[i]\n    return total / len(nums - 1)\n\nnumbers = [10, 20, 30, 40]\nprint(calculate_average(numbers))", fix: "return total / len(nums)", obj: "Fix the incorrect length calculation while computing the average.", diff: "Hard" },
    { lang: "C", bug: "#include <stdio.h>\n\nint findMax(int arr[], int n) {\n    int max = arr[0];\n    for(int i = 1; i <= n; i++) {\n        if(arr[i] > max) {\n            max = arr[i];\n        }\n    }\n    return max;\n}\n\nint main() {\n    int a[5] = {3, 9, 2, 8, 5};\n    printf(\"%d\", findMax(a, 5));\n    return 0;\n}", fix: "Change loop condition to i < n", obj: "Fix array out-of-bounds access in the loop.", diff: "Hard" },
    { lang: "Java", bug: "class Test {\n    static int factorial(int n) {\n        if(n == 0)\n            return 0;\n        return n * factorial(n - 1);\n    }\n\n    public static void main(String[] args) {\n        System.out.println(factorial(5));\n    }\n}", fix: "return 1 when n == 0", obj: "Fix the incorrect base condition in recursive factorial calculation.", diff: "Hard" },
    { lang: "JavaScript", bug: "function removeDuplicates(arr) {\n    let result = [];\n    for(let i = 0; i < arr.length; i++) {\n        if(result.indexOf(arr[i]) > 0) {\n            result.push(arr[i]);\n        }\n    }\n    return result;\n}\n\nconsole.log(removeDuplicates([1, 2, 2, 3, 4, 4]));", fix: "Change condition to indexOf(arr[i]) === -1", obj: "Fix the duplicate checking logic in the array.", diff: "Hard" },
    { lang: "HTML", bug: "<!DOCTYPE html>\n<html>\n<head>\n  <title>Login</title>\n</head>\n<body>\n  <form>\n    <input type=\"text\" name=\"username\" required>\n    <input type=\"password\" name=\"password\" required>\n    <button type=\"submit\">Login</button>\n  </form>\n</body>\n</html>", fix: "Add action and method attributes to the form tag", obj: "Fix the missing form submission configuration.", diff: "Hard" }
];

    let state = { lvlIdx: 0, questIdx: 0, lvlScore: 0, totalScore: 0, questions: [] };

    function initMenu() {
        const grid = document.getElementById('level-grid');
        grid.innerHTML = '';
        state.totalScore = levels.reduce((sum, l) => sum + l.score, 0); // Calculate true total
        
        levels.forEach((l, i) => {
            const card = document.createElement('div');
            card.className = `lvl-card ${l.unlocked ? '' : 'locked'}`;
            let scoreInfo = l.completed ? `<br><small style="color:var(--aurora-green)">SCORE: ${l.score}/${l.count*l.pts}</small>` : '';
            card.innerHTML = `<h3>${l.name}</h3><p>${l.diff}</p><small>${l.count} DATA BLOCKS</small>${scoreInfo}<br>${l.unlocked ? '' : '<span style="color:var(--warn-red)">ENCRYPTED</span>'}`;
            if(l.unlocked) card.onclick = () => startLevel(i);
            grid.appendChild(card);
        });
        document.getElementById('overall-score-display').innerText = `TOTAL SCORE: ${state.totalScore}/2500`;
    }

    function startLevel(i) {
        state.lvlIdx = i;
        state.questIdx = 0;
        state.lvlScore = 0; // Fresh level start
        state.questions = campaignPool.filter(q => q.diff === levels[i].diff);
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        renderQuestion();
    }

    function renderQuestion() {
        const q = state.questions[state.questIdx];
        document.getElementById('code-box').innerText = q.bug;
        document.getElementById('lang-tag').innerText = q.lang.toUpperCase();
        document.getElementById('objective-text').innerText = "OBJECTIVE: " + q.obj;
        document.getElementById('current-difficulty-label').innerText = `DIFFICULTY: ${q.diff.toUpperCase()}`;
        document.getElementById('level-tracker').innerText = `BLOCK: ${state.questIdx + 1}/${levels[state.lvlIdx].count}`;
        document.getElementById('lvl-score-tracker').innerText = `LEVEL_SCORE: ${state.lvlScore}`;
        document.getElementById('user-input').value = "";
    }

    function checkFix() {
        const input = document.getElementById('user-input').value.trim();
        const sol = state.questions[state.questIdx].fix;
        if(input.toLowerCase().includes(sol.toLowerCase())) {
            showToast("DATA STABILIZED", "var(--aurora-green)");
            confetti({ particleCount: 40, spread: 50 });
            state.lvlScore += levels[state.lvlIdx].pts;
            advance();
        } else { showToast("LOGIC ERROR", "var(--warn-red)"); }
    }

    function skipQuestion() {
        showToast("SKIPPED", "#888");
        advance();
    }

    function advance() {
        state.questIdx++;
        if(state.questIdx < levels[state.lvlIdx].count) { setTimeout(renderQuestion, 600); }
        else { setTimeout(showLevelComplete, 600); }
    }

    function showLevelComplete() {
        const cur = levels[state.lvlIdx];
        cur.score = state.lvlScore; // OVERWRITE old score with new score
        cur.completed = true;
        
        if(state.lvlIdx + 1 < levels.length) levels[state.lvlIdx + 1].unlocked = true;

        const modal = document.getElementById('modal-overlay');
        const content = document.getElementById('modal-content');
        modal.style.display = 'flex';
        content.innerHTML = `
            <h1 style="color:var(--aurora-green)">SECTOR CLEANED</h1>
            <p>CONGRATULATIONS! Sector <b>${cur.name}</b> sync complete.</p>
            <div style="font-size: 2.5rem; margin: 20px 0; font-family: 'Share Tech Mono'">${state.lvlScore} / ${cur.count * cur.pts}</div>
            <p style="color: var(--aurora-blue)">Sector score updated. Previous records purged.</p>
            <button class="btn-patch" style="width:100%" onclick="closeModal()">PROCEED TO NEXT SECTOR</button>`;
    }

    function closeModal() {
        document.getElementById('modal-overlay').style.display = 'none';
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('start-screen').classList.remove('hidden');
        initMenu();
    }

    function showToast(msg, color) {
        const t = document.getElementById('toast-msg');
        t.innerText = msg; t.style.color = color;
        t.classList.remove('hidden', 'animate__fadeOutUp');
        t.classList.add('animate__fadeInDown');
        setTimeout(() => { t.classList.add('animate__fadeOutUp'); }, 800);
    }
</script>
</body>
</html>